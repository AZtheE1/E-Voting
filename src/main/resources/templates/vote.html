<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Cast Your Vote - E-Voting</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <style>
        .ballot-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .candidate-card {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            padding: 1.5rem;
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s, border-color 0.2s;
            border: 2px solid transparent;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .candidate-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .candidate-card.selected {
            border-color: var(--primary);
            background-color: #eff6ff;
        }

        .symbol-img {
            width: 100px;
            height: 100px;
            object-fit: contain;
            margin-bottom: 1rem;
            border-radius: 50%;
            background-color: #f3f4f6;
            padding: 0.5rem;
        }

        .candidate-name {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-main);
            margin-bottom: 0.25rem;
        }

        .party-name {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin-bottom: 1.5rem;
        }

        .vote-btn {
            width: 100%;
            margin-top: auto;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal.show {
            display: flex;
            opacity: 1;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s ease;
            box-shadow: var(--shadow-lg);
        }

        .modal.show .modal-content {
            transform: scale(1);
        }
    </style>
</head>

<body>

    <nav class="navbar">
        <div class="container navbar-content">
            <a class="navbar-brand" th:href="@{/}">
                <img src="https://www.ecs.gov.bd/front/assets/images/logo.png" alt="logo">
                E-Voting System
            </a>
            <div class="navbar-nav">
                <span class="nav-item">Welcome, <span th:text="${voterName}">Voter</span></span>
                <form th:action="@{/logout}" method="post" style="display:inline;">
                    <button type="submit" class="btn btn-outline-danger btn-sm">Logout</button>
                </form>
            </div>
        </div>
    </nav>

    <div class="container main-content">
        <div class="text-center mb-5">
            <h1 class="display-5 fw-bold">Official Ballot Paper</h1>
            <p class="lead text-muted">Select your preferred candidate for <strong
                    th:text="${electionTitle}">Election</strong></p>
            <div class="alert alert-info d-inline-block">
                Constituency: <strong th:text="${constituencyName}">Dhaka-1</strong>
            </div>
        </div>

        <div th:if="${error}" class="alert alert-danger text-center">
            <span th:text="${error}">Error message</span>
        </div>

        <form th:action="@{/vote}" method="post" id="voteForm">
            <input type="hidden" name="electionId" th:value="${electionId}">
            <input type="hidden" name="voterId" th:value="${voterId}">
            <input type="hidden" name="candidateId" id="selectedCandidateId">

            <div class="ballot-grid">
                <div th:each="candidate : ${candidates}" class="candidate-card"
                    th:onclick="'selectCandidate(this, ' + ${candidate.candidate_id} + ')'">
                    <!-- Use symbol if available, else placeholder -->
                    <img th:src="${candidate.symbol != null ? candidate.symbol : 'https://placehold.co/100x100?text=Symbol'}"
                        alt="Symbol" class="symbol-img">

                    <h3 class="candidate-name" th:text="${candidate.full_name}">Candidate Name</h3>
                    <p class="party-name" th:text="${candidate.party_name}">Party Name</p>

                    <button type="button" class="btn btn-outline-primary vote-btn">Select</button>
                </div>
            </div>

            <div th:if="${#lists.isEmpty(candidates)}" class="alert alert-warning text-center mt-4">
                No candidates found for your constituency in this election.
            </div>

            <!-- Confirmation Modal -->
            <div id="confirmModal" class="modal">
                <div class="modal-content">
                    <h3 class="mb-3">Confirm Your Vote</h3>
                    <p class="text-muted mb-4">Are you sure you want to vote for <strong id="confirmName"
                            class="text-main"></strong>?</p>
                    <div class="d-flex gap-2 justify-content-center">
                        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Confirm Vote</button>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <div class="site-footer">
        &copy; 2025 E-Voting System. Secure & Transparent.
    </div>

    <script>
        function selectCandidate(card, id) {
            // Visual selection
            document.querySelectorAll('.candidate-card').forEach(c => {
                c.classList.remove('selected');
                c.querySelector('.vote-btn').classList.remove('btn-primary');
                c.querySelector('.vote-btn').classList.add('btn-outline-primary');
                c.querySelector('.vote-btn').innerText = 'Select';
            });

            card.classList.add('selected');
            const btn = card.querySelector('.vote-btn');
            btn.classList.remove('btn-outline-primary');
            btn.classList.add('btn-primary');
            btn.innerText = 'Selected';

            // Set value and show modal
            document.getElementById('selectedCandidateId').value = id;
            const name = card.querySelector('.candidate-name').innerText;
            document.getElementById('confirmName').innerText = name;

            // Small delay for better UX
            setTimeout(() => {
                const modal = document.getElementById('confirmModal');
                modal.classList.add('show');
            }, 200);
        }

        function closeModal() {
            const modal = document.getElementById('confirmModal');
            modal.classList.remove('show');
        }

        // Close modal on outside click
        window.onclick = function (event) {
            const modal = document.getElementById('confirmModal');
            if (event.target == modal) {
                closeModal();
            }
        }
    </script>

</body>

</html>